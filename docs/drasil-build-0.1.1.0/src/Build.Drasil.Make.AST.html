<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">-- | Defines a Makefile abstract syntax tree.</span><span>
</span><span id="line-2"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Build.Drasil.Make.AST</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-3"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Build.Drasil.Make.MakeString.html"><span class="hs-identifier">Build.Drasil.Make.MakeString</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Build.Drasil.Make.MakeString.html#MakeString"><span class="hs-identifier">MakeString</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">CodeLang.Drasil</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Comment</span></span><span class="hs-special">)</span><span>
</span><span id="line-5"></span><span>
</span><span id="line-6"></span><span class="hs-comment">-- * Types</span><span>
</span><span id="line-7"></span><span>
</span><span id="line-8"></span><span class="hs-comment">-- | A Makefile is made up of Makefile rules.</span><span>
</span><span id="line-9"></span><span class="hs-keyword">newtype</span><span> </span><span id="Makefile"><span class="annot"><a href="Build.Drasil.Make.AST.html#Makefile"><span class="hs-identifier hs-var">Makefile</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="M"><span class="annot"><a href="Build.Drasil.Make.AST.html#M"><span class="hs-identifier hs-var">M</span></a></span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Build.Drasil.Make.AST.html#Rule"><span class="hs-identifier hs-type">Rule</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-10"></span><span>
</span><span id="line-11"></span><span class="hs-comment">-- | A Makefile Rule can have comments and commands but needs a target,</span><span>
</span><span id="line-12"></span><span class="hs-comment">-- dependencies, and a type.</span><span>
</span><span id="line-13"></span><span class="hs-keyword">data</span><span> </span><span id="Rule"><span class="annot"><a href="Build.Drasil.Make.AST.html#Rule"><span class="hs-identifier hs-var">Rule</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="R"><span class="annot"><a href="Build.Drasil.Make.AST.html#R"><span class="hs-identifier hs-var">R</span></a></span></span><span> </span><span class="annot"><a href="Build.Drasil.Make.AST.html#Annotation"><span class="hs-identifier hs-type">Annotation</span></a></span><span> </span><span class="annot"><a href="Build.Drasil.Make.AST.html#Target"><span class="hs-identifier hs-type">Target</span></a></span><span> </span><span class="annot"><a href="Build.Drasil.Make.AST.html#Dependencies"><span class="hs-identifier hs-type">Dependencies</span></a></span><span> </span><span class="annot"><a href="Build.Drasil.Make.AST.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Build.Drasil.Make.AST.html#Command"><span class="hs-identifier hs-type">Command</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-14"></span><span>
</span><span id="line-15"></span><span class="hs-comment">-- | A command is made up of 'MakeString's and command operators.</span><span>
</span><span id="line-16"></span><span class="hs-keyword">data</span><span> </span><span id="Command"><span class="annot"><a href="Build.Drasil.Make.AST.html#Command"><span class="hs-identifier hs-var">Command</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="C"><span class="annot"><a href="Build.Drasil.Make.AST.html#C"><span class="hs-identifier hs-var">C</span></a></span></span><span> </span><span class="annot"><a href="Build.Drasil.Make.MakeString.html#MakeString"><span class="hs-identifier hs-type">MakeString</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Build.Drasil.Make.AST.html#CommandOpts"><span class="hs-identifier hs-type">CommandOpts</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-17"></span><span>
</span><span id="line-18"></span><span class="hs-comment">-- | Ignore the return code from the system.</span><span>
</span><span id="line-19"></span><span class="hs-keyword">data</span><span> </span><span id="CommandOpts"><span class="annot"><a href="Build.Drasil.Make.AST.html#CommandOpts"><span class="hs-identifier hs-var">CommandOpts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-20"></span><span>  </span><span id="IgnoreReturnCode"><span class="annot"><a href="Build.Drasil.Make.AST.html#IgnoreReturnCode"><span class="hs-identifier hs-var">IgnoreReturnCode</span></a></span></span><span> </span><span class="hs-keyword">deriving</span><span> </span><span id="local-6989586621679046031"><span id="local-6989586621679046033"><span class="annot"><span class="annottext">CommandOpts -&gt; CommandOpts -&gt; Bool
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: CommandOpts -&gt; CommandOpts -&gt; Bool
$c/= :: CommandOpts -&gt; CommandOpts -&gt; Bool
== :: CommandOpts -&gt; CommandOpts -&gt; Bool
$c== :: CommandOpts -&gt; CommandOpts -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span>
</span><span id="line-21"></span><span>
</span><span id="line-22"></span><span class="hs-comment">-- | Type of rule, either abstract or file-oriented.</span><span>
</span><span id="line-23"></span><span class="hs-keyword">data</span><span> </span><span id="Type"><span class="annot"><a href="Build.Drasil.Make.AST.html#Type"><span class="hs-identifier hs-var">Type</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Abstract"><span class="annot"><a href="Build.Drasil.Make.AST.html#Abstract"><span class="hs-identifier hs-var">Abstract</span></a></span></span><span>
</span><span id="line-24"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span id="File"><span class="annot"><a href="Build.Drasil.Make.AST.html#File"><span class="hs-identifier hs-var">File</span></a></span></span><span> </span><span class="hs-keyword">deriving</span><span> </span><span id="local-6989586621679046024"><span id="local-6989586621679046026"><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Bool
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: Type -&gt; Type -&gt; Bool
$c/= :: Type -&gt; Type -&gt; Bool
== :: Type -&gt; Type -&gt; Bool
$c== :: Type -&gt; Type -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span>
</span><span id="line-25"></span><span>
</span><span id="line-26"></span><span class="hs-comment">-- | A Makefile Annotation is made of 0 or more 'Comment's</span><span>
</span><span id="line-27"></span><span class="hs-keyword">type</span><span> </span><span id="Annotation"><span class="annot"><a href="Build.Drasil.Make.AST.html#Annotation"><span class="hs-identifier hs-var">Annotation</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Comment</span></span><span class="hs-special">]</span><span>
</span><span id="line-28"></span><span>
</span><span id="line-29"></span><span class="hs-comment">-- | A Makefile target is made from a 'MakeString'.</span><span>
</span><span id="line-30"></span><span class="hs-keyword">type</span><span> </span><span id="Target"><span class="annot"><a href="Build.Drasil.Make.AST.html#Target"><span class="hs-identifier hs-var">Target</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Build.Drasil.Make.MakeString.html#MakeString"><span class="hs-identifier hs-type">MakeString</span></a></span><span>
</span><span id="line-31"></span><span class="hs-comment">-- | Dependencies are made up of 0 or more 'Target's.</span><span>
</span><span id="line-32"></span><span class="hs-keyword">type</span><span> </span><span id="Dependencies"><span class="annot"><a href="Build.Drasil.Make.AST.html#Dependencies"><span class="hs-identifier hs-var">Dependencies</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Build.Drasil.Make.AST.html#Target"><span class="hs-identifier hs-type">Target</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-33"></span><span>
</span><span id="line-34"></span><span class="hs-comment">-- * Constructors</span><span>
</span><span id="line-35"></span><span>
</span><span id="line-36"></span><span class="hs-comment">-- | Creates a Rule which results in a file being created.</span><span>
</span><span id="line-37"></span><span class="annot"><a href="Build.Drasil.Make.AST.html#mkFile"><span class="hs-identifier hs-type">mkFile</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Build.Drasil.Make.AST.html#Annotation"><span class="hs-identifier hs-type">Annotation</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Build.Drasil.Make.AST.html#Target"><span class="hs-identifier hs-type">Target</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Build.Drasil.Make.AST.html#Dependencies"><span class="hs-identifier hs-type">Dependencies</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Build.Drasil.Make.AST.html#Command"><span class="hs-identifier hs-type">Command</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Build.Drasil.Make.AST.html#Rule"><span class="hs-identifier hs-type">Rule</span></a></span><span>
</span><span id="line-38"></span><span id="mkFile"><span class="annot"><span class="annottext">mkFile :: Annotation -&gt; Target -&gt; Dependencies -&gt; [Command] -&gt; Rule
</span><a href="Build.Drasil.Make.AST.html#mkFile"><span class="hs-identifier hs-var hs-var">mkFile</span></a></span></span><span> </span><span id="local-6989586621679046022"><span class="annot"><span class="annottext">Annotation
</span><a href="#local-6989586621679046022"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621679046021"><span class="annot"><span class="annottext">Target
</span><a href="#local-6989586621679046021"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621679046020"><span class="annot"><span class="annottext">Dependencies
</span><a href="#local-6989586621679046020"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Annotation -&gt; Target -&gt; Dependencies -&gt; Type -&gt; [Command] -&gt; Rule
</span><a href="Build.Drasil.Make.AST.html#R"><span class="hs-identifier hs-var">R</span></a></span><span> </span><span class="annot"><span class="annottext">Annotation
</span><a href="#local-6989586621679046022"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Target
</span><a href="#local-6989586621679046021"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">Dependencies
</span><a href="#local-6989586621679046020"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="Build.Drasil.Make.AST.html#File"><span class="hs-identifier hs-var">File</span></a></span><span>
</span><span id="line-39"></span><span>
</span><span id="line-40"></span><span class="hs-comment">-- | Creates an abstract Rule not associated to a specific file.</span><span>
</span><span id="line-41"></span><span class="annot"><a href="Build.Drasil.Make.AST.html#mkRule"><span class="hs-identifier hs-type">mkRule</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Build.Drasil.Make.AST.html#Annotation"><span class="hs-identifier hs-type">Annotation</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Build.Drasil.Make.AST.html#Target"><span class="hs-identifier hs-type">Target</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Build.Drasil.Make.AST.html#Dependencies"><span class="hs-identifier hs-type">Dependencies</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Build.Drasil.Make.AST.html#Command"><span class="hs-identifier hs-type">Command</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Build.Drasil.Make.AST.html#Rule"><span class="hs-identifier hs-type">Rule</span></a></span><span>
</span><span id="line-42"></span><span id="mkRule"><span class="annot"><span class="annottext">mkRule :: Annotation -&gt; Target -&gt; Dependencies -&gt; [Command] -&gt; Rule
</span><a href="Build.Drasil.Make.AST.html#mkRule"><span class="hs-identifier hs-var hs-var">mkRule</span></a></span></span><span> </span><span id="local-6989586621679046018"><span class="annot"><span class="annottext">Annotation
</span><a href="#local-6989586621679046018"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621679046017"><span class="annot"><span class="annottext">Target
</span><a href="#local-6989586621679046017"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621679046016"><span class="annot"><span class="annottext">Dependencies
</span><a href="#local-6989586621679046016"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Annotation -&gt; Target -&gt; Dependencies -&gt; Type -&gt; [Command] -&gt; Rule
</span><a href="Build.Drasil.Make.AST.html#R"><span class="hs-identifier hs-var">R</span></a></span><span> </span><span class="annot"><span class="annottext">Annotation
</span><a href="#local-6989586621679046018"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Target
</span><a href="#local-6989586621679046017"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">Dependencies
</span><a href="#local-6989586621679046016"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="Build.Drasil.Make.AST.html#Abstract"><span class="hs-identifier hs-var">Abstract</span></a></span><span>
</span><span id="line-43"></span><span>
</span><span id="line-44"></span><span class="hs-comment">-- | Creates a Command which fails the make process if it does not return zero.</span><span>
</span><span id="line-45"></span><span class="annot"><a href="Build.Drasil.Make.AST.html#mkCheckedCommand"><span class="hs-identifier hs-type">mkCheckedCommand</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Build.Drasil.Make.MakeString.html#MakeString"><span class="hs-identifier hs-type">MakeString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Build.Drasil.Make.AST.html#Command"><span class="hs-identifier hs-type">Command</span></a></span><span>
</span><span id="line-46"></span><span id="mkCheckedCommand"><span class="annot"><span class="annottext">mkCheckedCommand :: Target -&gt; Command
</span><a href="Build.Drasil.Make.AST.html#mkCheckedCommand"><span class="hs-identifier hs-var hs-var">mkCheckedCommand</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">Target -&gt; [CommandOpts] -&gt; Command
</span><a href="Build.Drasil.Make.AST.html#C"><span class="hs-identifier hs-var">C</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-47"></span><span>
</span><span id="line-48"></span><span class="hs-comment">-- | Creates a command which executes and ignores the return code.</span><span>
</span><span id="line-49"></span><span class="annot"><a href="Build.Drasil.Make.AST.html#mkCommand"><span class="hs-identifier hs-type">mkCommand</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Build.Drasil.Make.MakeString.html#MakeString"><span class="hs-identifier hs-type">MakeString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Build.Drasil.Make.AST.html#Command"><span class="hs-identifier hs-type">Command</span></a></span><span>
</span><span id="line-50"></span><span id="mkCommand"><span class="annot"><span class="annottext">mkCommand :: Target -&gt; Command
</span><a href="Build.Drasil.Make.AST.html#mkCommand"><span class="hs-identifier hs-var hs-var">mkCommand</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">Target -&gt; [CommandOpts] -&gt; Command
</span><a href="Build.Drasil.Make.AST.html#C"><span class="hs-identifier hs-var">C</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">CommandOpts
</span><a href="Build.Drasil.Make.AST.html#IgnoreReturnCode"><span class="hs-identifier hs-var">IgnoreReturnCode</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-51"></span></pre></body></html>