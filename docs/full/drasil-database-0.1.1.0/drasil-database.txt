-- Hoogle documentation, generated by Haddock
-- See Hoogle, http://www.haskell.org/hoogle/


-- | A framework for code and document generation for scientific software - Database SubPackage
--   
--   Please see the README on GitHub at
--   <a>https://github.com/JacquesCarette/Drasil#readme</a>
@package drasil-database
@version 0.1.1.0


-- | Unique Identifier used across Drasil.
module Drasil.Database.UID

-- | A <tt>UID</tt> is a 'unique identifier' for things that we will put
--   into our database of information. We use a newtype wrapper to make
--   sure we are only using <a>UID</a>s where desired.
data UID

-- | The most basic item: having a unique identifier key, here a UID.
class HasUID c

-- | Provides a <i>unique</i> id for internal Drasil use.
uid :: HasUID c => Getter c UID

-- | Smart constructor for <a>UID</a>s from raw <a>Value</a>s.
mkUid :: String -> UID

-- | Nest a <a>UID</a> under a namespace.
nsUid :: String -> UID -> UID

-- | Append a suffix to a thing with a <a>UID</a> and get the resulting
--   <a>UID</a>.
(+++) :: HasUID a => a -> String -> UID

-- | Append a suffix to a <a>UID</a>.
(+++.) :: UID -> String -> UID

-- | Merge the <a>UID</a>s of two chunks through simple concatenation.
(+++!) :: (HasUID a, HasUID b) => a -> b -> UID

-- | Get something's <a>UID</a> as a <a>Value</a>.
showUID :: HasUID a => a -> String
instance Data.Aeson.Types.ToJSON.ToJSON Drasil.Database.UID.UID
instance Data.Aeson.Types.ToJSON.ToJSONKey Drasil.Database.UID.UID
instance GHC.Show.Show Drasil.Database.UID.UID
instance GHC.Generics.Generic Drasil.Database.UID.UID
instance GHC.Classes.Ord Drasil.Database.UID.UID
instance GHC.Classes.Eq Drasil.Database.UID.UID

module Drasil.Database.Chunk

-- | A piece of reusable knowledge, with an internal identifier
--   (<a>UID</a>), possibly dependant on other chunks.
data Chunk

-- | Constraint for anything that may be considered a valid chunk type.
type IsChunk a = (HasUID a, HasChunkRefs a, Typeable a)

-- | All chunks should expose what chunks they reference/rely on, so that
--   we can test <tt>ChunkDB</tt>s to ensure all presupposed chunks are
--   already registered.
class HasChunkRefs a
chunkRefs :: HasChunkRefs a => a -> Set UID

-- | Create a <a>Chunk</a>, ensuring that <a>Chunk</a>s are never placed
--   within <a>Chunk</a>s.
mkChunk :: IsChunk a => a -> Chunk

-- | <a>Open</a> chunks, casting them to a specific type.
unChunk :: Typeable a => Chunk -> Maybe a

-- | Ask a <a>Chunk</a> for the type of data it codifies.
chunkType :: Chunk -> TypeRep
instance GHC.Classes.Eq Drasil.Database.Chunk.Chunk
instance Drasil.Database.UID.HasUID Drasil.Database.Chunk.Chunk
instance Drasil.Database.Chunk.HasChunkRefs Drasil.Database.Chunk.Chunk

module Drasil.Database.ChunkDB

-- | Drasil's knowledge database.
data ChunkDB

-- | An empty <a>ChunkDB</a>.
empty :: ChunkDB

-- | Create a <a>ChunkDB</a> from a list of chunks. This will insert all
--   chunks into the database from the list, from left to right.
fromList :: IsChunk a => [a] -> ChunkDB

-- | Query the <a>ChunkDB</a> for all registered chunks (by their
--   <a>UID</a>s).
registered :: ChunkDB -> [UID]

-- | Enumerate all types registered in the <a>ChunkDB</a>.
typesRegistered :: ChunkDB -> [TypeRep]

-- | Get the number of chunks registered in the <a>ChunkDB</a>.
size :: ChunkDB -> Int

-- | Check if a <a>UID</a> is registered in the <a>ChunkDB</a>.
isRegistered :: UID -> ChunkDB -> Bool

-- | Filter the <a>ChunkDB</a> for chunks that are not needed by any other
--   chunks. These are the only chunks that can safely be removed from the
--   database, though we do not include this functionality.
findUnused :: ChunkDB -> [UID]

-- | Find a chunk by its <a>UID</a> in the <a>ChunkDB</a>.
find :: Typeable a => UID -> ChunkDB -> Maybe a

-- | Find a chunk by its <a>UID</a> in the <a>ChunkDB</a>, throwing a hard
--   error if it is not found.
findOrErr :: forall a. Typeable a => UID -> ChunkDB -> a

-- | Find all chunks of a specific type in the <a>ChunkDB</a>.
findAll :: forall a. IsChunk a => ChunkDB -> [a]

-- | Find all chunks of a specific type in the <a>ChunkDB</a>, returning
--   their <a>UID</a>s rather than the chunks themselves.
findAll' :: TypeRep -> ChunkDB -> [UID]

-- | Find all chunks that depend on a specific one.
dependants :: UID -> ChunkDB -> Maybe [UID]

-- | Find all chunks that depend on a specific one, throwing a hard error
--   if the dependency chunk is not found.
dependantsOrErr :: UID -> ChunkDB -> [UID]

-- | Find the type of a chunk by its <a>UID</a>.
findTypeOf :: UID -> ChunkDB -> Maybe TypeRep

-- | Insert a chunk into the <a>ChunkDB</a> if it is sensible to do so
--   (i.e., does not depend on itself, is not a <a>ChunkDB</a>, and does
--   not overwrite another chunk).
insert :: IsChunk a => a -> ChunkDB -> ChunkDB

-- | Insert a list of chunks into a <a>ChunkDB</a>.
insertAll :: IsChunk a => [a] -> ChunkDB -> ChunkDB

-- | Insert 11 lists of <i>unique</i> chunk types into a <a>ChunkDB</a>,
--   assuming the input <a>ChunkDB</a> does not already contain any of the
--   chunks from the chunk lists.
insertAllOutOfOrder11 :: (IsChunk a, IsChunk b, IsChunk c, IsChunk d, IsChunk e, IsChunk f, IsChunk g, IsChunk h, IsChunk i, IsChunk j, IsChunk k) => ChunkDB -> [a] -> [b] -> [c] -> [d] -> [e] -> [f] -> [g] -> [h] -> [i] -> [j] -> [k] -> ChunkDB

module Drasil.Database.TypedUIDRef

-- | <a>UID</a> references that contain information about the type of data
--   the <a>UID</a> refers to, useful for type-safe dereferencing.
data TypedUIDRef typ

-- | Create a <a>TypedUIDRef</a> to a chunk.
mkRef :: IsChunk t => t -> TypedUIDRef t

-- | Find a chunk by its typed UID reference.
typedFind :: IsChunk t => TypedUIDRef t -> ChunkDB -> Maybe t

-- | Find a chunk by its typed UID reference, erroring if not found.
typedFindOrErr :: IsChunk t => TypedUIDRef t -> ChunkDB -> t

module Drasil.Database.Dump
type ChunkType = String

-- | A dumped representation of a <a>ChunkDB</a>, mapping chunk types
--   (<a>String</a>s) to lists of <a>UID</a>s.
type DumpedChunkDB = Map ChunkType [UID]
dumpChunkDB :: ChunkDB -> DumpedChunkDB


-- | Re-export database types and functions to simplify external use.
module Drasil.Database
