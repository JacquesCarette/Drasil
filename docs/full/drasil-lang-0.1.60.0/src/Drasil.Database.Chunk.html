<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE ExistentialQuantification #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE TypeApplications #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE ConstraintKinds #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE InstanceSigs #-}</span><span>
</span><span id="line-5"></span><span>
</span><span id="line-6"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Drasil.Database.Chunk</span><span>
</span><span id="line-7"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Drasil.Database.Chunk.html#Chunk"><span class="hs-identifier">Chunk</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-8"></span><span>    </span><span class="annot"><a href="Drasil.Database.Chunk.html#IsChunk"><span class="hs-identifier">IsChunk</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-9"></span><span>    </span><span class="annot"><a href="Drasil.Database.Chunk.html#HasChunkRefs"><span class="hs-identifier">HasChunkRefs</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-10"></span><span>    </span><span class="annot"><a href="Drasil.Database.Chunk.html#mkChunk"><span class="hs-identifier">mkChunk</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-11"></span><span>    </span><span class="annot"><a href="Drasil.Database.Chunk.html#unChunk"><span class="hs-identifier">unChunk</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-12"></span><span>    </span><span class="annot"><a href="Drasil.Database.Chunk.html#chunkType"><span class="hs-identifier">chunkType</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-13"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-14"></span><span class="hs-keyword">where</span><span>
</span><span id="line-15"></span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Lens</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-operator">(^.)</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">to</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Getter</span></span><span class="hs-special">)</span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Typeable</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Proxy</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Proxy</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">TypeRep</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Typeable</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">cast</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">typeOf</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">typeRep</span></span><span class="hs-special">)</span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">S</span></span><span>
</span><span id="line-19"></span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Drasil.Database.UID.html"><span class="hs-identifier">Drasil.Database.UID</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Drasil.Database.UID.html#HasUID"><span class="hs-identifier">HasUID</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Drasil.Database.UID.html#UID"><span class="hs-identifier">UID</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-21"></span><span>
</span><span id="line-22"></span><span class="hs-comment">-- | All chunks should expose what chunks they reference/rely on, so that we can</span><span>
</span><span id="line-23"></span><span class="hs-comment">-- test 'ChunkDB's to ensure all presupposed chunks are already registered.</span><span>
</span><span id="line-24"></span><span class="hs-keyword">class</span><span> </span><span id="HasChunkRefs"><span class="annot"><a href="Drasil.Database.Chunk.html#HasChunkRefs"><span class="hs-identifier hs-var">HasChunkRefs</span></a></span></span><span> </span><span id="local-6989586621679414620"><span class="annot"><a href="#local-6989586621679414620"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-25"></span><span>  </span><span id="chunkRefs"><span class="annot"><a href="Drasil.Database.Chunk.html#chunkRefs"><span class="hs-identifier hs-type">chunkRefs</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679414620"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">S.Set</span></span><span> </span><span class="annot"><a href="Drasil.Database.UID.html#UID"><span class="hs-identifier hs-type">UID</span></a></span><span>
</span><span id="line-26"></span><span>
</span><span id="line-27"></span><span class="annot"><span class="hs-comment">-- | Constraint for anything that may be considered a valid chunk type.</span></span><span>
</span><span id="line-28"></span><span class="hs-keyword">type</span><span> </span><span id="IsChunk"><span class="annot"><a href="Drasil.Database.Chunk.html#IsChunk"><span class="hs-identifier hs-var">IsChunk</span></a></span></span><span> </span><span id="local-6989586621679414623"><span class="annot"><a href="#local-6989586621679414623"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Drasil.Database.UID.html#HasUID"><span class="hs-identifier hs-type">HasUID</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679414623"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Drasil.Database.Chunk.html#HasChunkRefs"><span class="hs-identifier hs-type">HasChunkRefs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679414623"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Typeable</span></span><span> </span><span class="annot"><a href="#local-6989586621679414623"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-29"></span><span>
</span><span id="line-30"></span><span class="hs-comment">-- | A piece of reusable knowledge, with an internal identifier ('UID'),</span><span>
</span><span id="line-31"></span><span class="hs-comment">-- possibly dependant on other chunks.</span><span>
</span><span id="line-32"></span><span class="hs-keyword">data</span><span> </span><span id="Chunk"><span class="annot"><a href="Drasil.Database.Chunk.html#Chunk"><span class="hs-identifier hs-var">Chunk</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679414624"><span class="annot"><a href="#local-6989586621679414624"><span class="hs-identifier hs-type">a</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="Drasil.Database.Chunk.html#IsChunk"><span class="hs-identifier hs-type">IsChunk</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679414624"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span id="Chunk"><span class="annot"><a href="Drasil.Database.Chunk.html#Chunk"><span class="hs-identifier hs-var">Chunk</span></a></span></span><span> </span><span class="annot"><a href="#local-6989586621679414624"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-33"></span><span>
</span><span id="line-34"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679414628"><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="Drasil.Database.Chunk.html#Chunk"><span class="hs-identifier hs-type">Chunk</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-35"></span><span>  </span><span class="annot"><span class="hs-operator hs-type">(==)</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Drasil.Database.Chunk.html#Chunk"><span class="hs-identifier hs-type">Chunk</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Drasil.Database.Chunk.html#Chunk"><span class="hs-identifier hs-type">Chunk</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-36"></span><span>  </span><span id="local-6989586621679414643"><span class="annot"><span class="annottext">Chunk
</span><a href="#local-6989586621679414643"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621679414644"><span class="annot"><span class="annottext">== :: Chunk -&gt; Chunk -&gt; Bool
</span><span class="hs-operator hs-var hs-var hs-var hs-var">==</span></span></span><span> </span><span id="local-6989586621679414645"><span class="annot"><span class="annottext">Chunk
</span><a href="#local-6989586621679414645"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Chunk
</span><a href="#local-6989586621679414643"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">Chunk -&gt; Getting UID Chunk UID -&gt; UID
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">Getting UID Chunk UID
forall c. HasUID c =&gt; Getter c UID
Getter Chunk UID
</span><a href="Drasil.Database.UID.html#uid"><span class="hs-identifier hs-var">uid</span></a></span><span> </span><span class="annot"><span class="annottext">UID -&gt; UID -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Chunk
</span><a href="#local-6989586621679414645"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Chunk -&gt; Getting UID Chunk UID -&gt; UID
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">Getting UID Chunk UID
forall c. HasUID c =&gt; Getter c UID
Getter Chunk UID
</span><a href="Drasil.Database.UID.html#uid"><span class="hs-identifier hs-var">uid</span></a></span><span>
</span><span id="line-37"></span><span>
</span><span id="line-38"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Drasil.Database.UID.html#HasUID"><span class="hs-identifier hs-type">HasUID</span></a></span><span> </span><span class="annot"><a href="Drasil.Database.Chunk.html#Chunk"><span class="hs-identifier hs-type">Chunk</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-39"></span><span>  </span><span class="annot"><a href="Drasil.Database.UID.html#uid"><span class="hs-identifier hs-type">uid</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Getter</span></span><span> </span><span class="annot"><a href="Drasil.Database.Chunk.html#Chunk"><span class="hs-identifier hs-type">Chunk</span></a></span><span> </span><span class="annot"><a href="Drasil.Database.UID.html#UID"><span class="hs-identifier hs-type">UID</span></a></span><span>
</span><span id="line-40"></span><span>  </span><span id="local-6989586621679414658"><span class="annot"><span class="annottext">uid :: Getter Chunk UID
</span><a href="Drasil.Database.UID.html#uid"><span class="hs-identifier hs-var hs-var hs-var hs-var">uid</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Chunk -&gt; UID) -&gt; (UID -&gt; f UID) -&gt; Chunk -&gt; f Chunk
forall (p :: * -&gt; * -&gt; *) (f :: * -&gt; *) s a.
(Profunctor p, Contravariant f) =&gt;
(s -&gt; a) -&gt; Optic' p f s a
</span><span class="hs-identifier hs-var">to</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><a href="Drasil.Database.Chunk.html#Chunk"><span class="hs-identifier hs-type">Chunk</span></a></span><span> </span><span id="local-6989586621679414664"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679414664"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679414664"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; Getting UID a UID -&gt; UID
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">Getting UID a UID
forall c. HasUID c =&gt; Getter c UID
Getter a UID
</span><a href="Drasil.Database.UID.html#uid"><span class="hs-identifier hs-var">uid</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-41"></span><span>
</span><span id="line-42"></span><span class="annot"><span class="hs-comment">-- | Create a 'Chunk', ensuring that 'Chunk's are never placed within 'Chunk's.</span></span><span>
</span><span id="line-43"></span><span id="local-6989586621679414591"><span class="annot"><a href="Drasil.Database.Chunk.html#mkChunk"><span class="hs-identifier hs-type">mkChunk</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Drasil.Database.Chunk.html#IsChunk"><span class="hs-identifier hs-type">IsChunk</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679414591"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679414591"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Drasil.Database.Chunk.html#Chunk"><span class="hs-identifier hs-type">Chunk</span></a></span></span><span>
</span><span id="line-44"></span><span id="mkChunk"><span class="annot"><span class="annottext">mkChunk :: forall a. IsChunk a =&gt; a -&gt; Chunk
</span><a href="Drasil.Database.Chunk.html#mkChunk"><span class="hs-identifier hs-var hs-var">mkChunk</span></a></span></span><span> </span><span id="local-6989586621679414674"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679414674"><span class="hs-identifier hs-var">a</span></a></span></span><span>
</span><span id="line-45"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">a -&gt; TypeRep
forall a. Typeable a =&gt; a -&gt; TypeRep
</span><span class="hs-identifier hs-var">typeOf</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679414674"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">TypeRep -&gt; TypeRep -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Proxy Chunk -&gt; TypeRep
forall {k} (proxy :: k -&gt; *) (a :: k).
Typeable a =&gt;
proxy a -&gt; TypeRep
</span><span class="hs-identifier hs-var">typeRep</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall t. Proxy t
forall {k} (t :: k). Proxy t
</span><span class="hs-identifier hs-var">Proxy</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="Drasil.Database.Chunk.html#Chunk"><span class="hs-identifier hs-type">Chunk</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Chunk
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Cannot place a Chunk inside of a Chunk&quot;</span></span><span>
</span><span id="line-46"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; Chunk
forall a. IsChunk a =&gt; a -&gt; Chunk
</span><a href="Drasil.Database.Chunk.html#Chunk"><span class="hs-identifier hs-var">Chunk</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679414674"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-47"></span><span>
</span><span id="line-48"></span><span class="annot"><span class="hs-comment">-- | &quot;Open&quot; chunks, casting them to a specific type.</span></span><span>
</span><span id="line-49"></span><span id="local-6989586621679414604"><span class="annot"><a href="Drasil.Database.Chunk.html#unChunk"><span class="hs-identifier hs-type">unChunk</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Typeable</span></span><span> </span><span class="annot"><a href="#local-6989586621679414604"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Drasil.Database.Chunk.html#Chunk"><span class="hs-identifier hs-type">Chunk</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621679414604"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-50"></span><span id="unChunk"><span class="annot"><span class="annottext">unChunk :: forall a. Typeable a =&gt; Chunk -&gt; Maybe a
</span><a href="Drasil.Database.Chunk.html#unChunk"><span class="hs-identifier hs-var hs-var">unChunk</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Drasil.Database.Chunk.html#Chunk"><span class="hs-identifier hs-type">Chunk</span></a></span><span> </span><span id="local-6989586621679414681"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679414681"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; Maybe a
forall a b. (Typeable a, Typeable b) =&gt; a -&gt; Maybe b
</span><span class="hs-identifier hs-var">cast</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679414681"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-51"></span><span>
</span><span id="line-52"></span><span class="annot"><span class="hs-comment">-- | Ask a 'Chunk' for the type of data it codifies.</span></span><span>
</span><span id="line-53"></span><span class="annot"><a href="Drasil.Database.Chunk.html#chunkType"><span class="hs-identifier hs-type">chunkType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Drasil.Database.Chunk.html#Chunk"><span class="hs-identifier hs-type">Chunk</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TypeRep</span></span><span>
</span><span id="line-54"></span><span id="chunkType"><span class="annot"><span class="annottext">chunkType :: Chunk -&gt; TypeRep
</span><a href="Drasil.Database.Chunk.html#chunkType"><span class="hs-identifier hs-var hs-var">chunkType</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Drasil.Database.Chunk.html#Chunk"><span class="hs-identifier hs-type">Chunk</span></a></span><span> </span><span id="local-6989586621679414685"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679414685"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; TypeRep
forall a. Typeable a =&gt; a -&gt; TypeRep
</span><span class="hs-identifier hs-var">typeOf</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679414685"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-55"></span></pre></body></html>