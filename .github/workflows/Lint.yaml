on:
  pull_request:
    branches: main
  workflow_dispatch:
    paths: [code/drasil-**, .github/workflows/Lint.yaml]
name: Linter
concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true
defaults:
  run:
    shell: bash
    working-directory: code
jobs:
  linter:
    name: "HLint"
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      # Once we update our LTS, we can remove this step, see "Inputs": https://github.com/haskell-actions/hlint-setup
      - name: 'Install HLint system dependencies'
        run: |
          sudo apt-get update
          sudo apt-get install -y libtinfo5

      - name: 'Set up HLint'
        uses: haskell-actions/hlint-setup@v2
        with: # DO NOT MODIFY THE BELOW LINE MANUALLY -- code/scripts/update_default_stackage.sh is in charge of this!
          version: '3.4.1' # HLINT VERSION TIED TO CURRENT TARGET (LTS-20.26)

      - name: 'Run HLint'
        uses: haskell-actions/hlint-run@v2
        with: # The custom hlint-bin is necessary because we need to inject options to hlint, since hlint-run does not support it yet, see: https://github.com/haskell-actions/hlint-run/issues/20
          hlint-bin: hlint --hint=code/.hlint.yaml
          path: code/
          fail-on: status
